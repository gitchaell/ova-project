import{j as e,P as _,u as W,c as V}from"./index.C-M3_CjP.js";import{r as l,R as b}from"./index.Cpi2Ks0G.js";import{u as F}from"./use-toast.BAq_dyGy.js";import{A as Ae,I as we,a as ye,b as Se}from"./alert.cTtBj1Dv.js";import{n as P}from"./router.7tVD49SL.js";import{C as De,a as _e,b as Pe,c as Ee}from"./card.CKo05vsE.js";import{A as Ie,a as Le,b as Re,c as Te,d as Oe,e as ke,f as Me,g as $e,h as He}from"./alert-dialog.DpSbKqzE.js";import{D as Ve,a as Fe,E as Ge,C as Be,B as D,b as Ue,c as ze,d as Q,e as Ke,f as O,T as qe,S as k,P as Je}from"./skeleton.C5CUaIhD.js";import{l as Ye,L as Qe,S as We}from"./LessonDate.Bh2mHM41.js";import{B as E}from"./button.Ry9IsCwB.js";import{S as Xe}from"./settings.CvriO5X6.js";import{c as X}from"./createLucideIcon.DlBfeOJM.js";import{u as Ze,T as eo,a as oo,b as M,c as $}from"./tabs.CEIVxK54.js";import{c as to}from"./index.B-mGbkiQ.js";import{u as G,c as Z,P as no}from"./index.Dox3Ggkk.js";import{u as so}from"./index.DYGEF4Um.js";import{u as ee}from"./index.C3Bs01oF.js";import{C as ro}from"./calendar._5A8bYNN.js";import"./index.CxOCE76-.js";import"./index.CSNuKgWl.js";import"./index.BjuswFHX.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=X("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=X("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),io=({lesson:o})=>{const{toast:r}=F(),t=async()=>{const s=await(await fetch("/api/lessons",{method:"DELETE",headers:{Accept:"application.json","Content-Type":"application/json"},body:JSON.stringify({lessonId:o.id})})).json();s.message==="success"?r({title:"Lección eliminada",description:`La lección "${o.title}" ha sido eliminada`}):r({title:"Algo salió mal!",description:s.message,variant:"destructive"})};return e.jsxs(Ie,{children:[e.jsxs(Ve,{children:[e.jsx(De,{className:"cursor-pointer hover:bg-slate-50",onClick:()=>P("/lessons/editor/"+o.id),children:e.jsxs(_e,{children:[e.jsxs("div",{className:"grid grid-cols-[1fr_min-content] gap-2",children:[e.jsx(Pe,{children:o.title}),e.jsx(Fe,{asChild:!0,children:e.jsx(E,{type:"button",size:"icon",variant:"outline",children:e.jsx(Ge,{})})})]}),e.jsx(Ee,{className:"text-slate-700 line-clamp-2",children:o.caption}),e.jsxs("div",{className:"grid grid-cols-[1fr_min-content] items-center gap-2 ",children:[e.jsxs("div",{className:"grid grid-cols-[min-content_1fr_min-content] items-center gap-2 text-sm text-gray-500",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:Ye.formatRange(new Date(o.start),new Date(o.end))})]}),o.done?e.jsx(D,{className:"bg-green-100 border-green-500 text-green-600 hover:bg-green-200 w-fit",children:"Finalizado"}):e.jsx(D,{variant:"outline",className:"w-fit",children:"Pendiente"})]})]})}),e.jsxs(Ue,{className:"w-56",children:[e.jsx(ze,{children:"Opciones"}),e.jsx(Q,{}),e.jsxs(Ke,{children:[e.jsxs(O,{onSelect:()=>P("/lessons/editor/"+o.id),children:[e.jsx(Xe,{}),e.jsx("span",{children:"Editar"})]}),e.jsxs(O,{onSelect:()=>P("/lessons/preview/"+o.id),children:[e.jsx(co,{}),e.jsx("span",{children:"Previsualizar"})]})]}),e.jsx(Q,{}),e.jsx(Le,{asChild:!0,children:e.jsxs(O,{className:"text-red-500",children:[e.jsx(qe,{}),e.jsx("span",{children:"Eliminar"})]})})]})]}),e.jsxs(Re,{children:[e.jsxs(Te,{children:[e.jsxs(Oe,{children:['¿Está seguro de eliminar la lección "',o.title,'"?']}),e.jsx(ke,{children:"Esta acción no se podrá deshacer. Todos los datos de esta lección serán eliminados permanentemente de la de base de datos."})]}),e.jsxs(Me,{children:[e.jsx($e,{children:"Cancelar"}),e.jsx(He,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:t,children:"Eliminar lección"})]})]})]})};function lo(o,r=[]){let t=[];function a(n,c){const i=l.createContext(c),d=t.length;t=[...t,c];const p=u=>{const{scope:v,children:g,...h}=u,C=v?.[o]?.[d]||i,j=l.useMemo(()=>h,Object.values(h));return e.jsx(C.Provider,{value:j,children:g})};p.displayName=n+"Provider";function f(u,v){const g=v?.[o]?.[d]||i,h=l.useContext(g);if(h)return h;if(c!==void 0)return c;throw new Error(`\`${u}\` must be used within \`${n}\``)}return[p,f]}const s=()=>{const n=t.map(c=>l.createContext(c));return function(i){const d=i?.[o]||n;return l.useMemo(()=>({[`__scope${o}`]:{...i,[o]:d}}),[i,d])}};return s.scopeName=o,[a,po(s,...r)]}function po(...o){const r=o[0];if(o.length===1)return r;const t=()=>{const a=o.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(n){const c=a.reduce((i,{useScope:d,scopeName:p})=>{const u=d(n)[`__scope${p}`];return{...i,...u}},{});return l.useMemo(()=>({[`__scope${r.scopeName}`]:c}),[c])}};return t.scopeName=r.scopeName,t}function uo(o,r=[]){let t=[];function a(n,c){const i=l.createContext(c),d=t.length;t=[...t,c];const p=u=>{const{scope:v,children:g,...h}=u,C=v?.[o]?.[d]||i,j=l.useMemo(()=>h,Object.values(h));return e.jsx(C.Provider,{value:j,children:g})};p.displayName=n+"Provider";function f(u,v){const g=v?.[o]?.[d]||i,h=l.useContext(g);if(h)return h;if(c!==void 0)return c;throw new Error(`\`${u}\` must be used within \`${n}\``)}return[p,f]}const s=()=>{const n=t.map(c=>l.createContext(c));return function(i){const d=i?.[o]||n;return l.useMemo(()=>({[`__scope${o}`]:{...i,[o]:d}}),[i,d])}};return s.scopeName=o,[a,mo(s,...r)]}function mo(...o){const r=o[0];if(o.length===1)return r;const t=()=>{const a=o.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(n){const c=a.reduce((i,{useScope:d,scopeName:p})=>{const u=d(n)[`__scope${p}`];return{...i,...u}},{});return l.useMemo(()=>({[`__scope${r.scopeName}`]:c}),[c])}};return t.scopeName=r.scopeName,t}var B="Collapsible",[xo,oe]=uo(B),[fo,U]=xo(B),te=l.forwardRef((o,r)=>{const{__scopeCollapsible:t,open:a,defaultOpen:s,disabled:n,onOpenChange:c,...i}=o,[d=!1,p]=G({prop:a,defaultProp:s,onChange:c});return e.jsx(fo,{scope:t,disabled:n,contentId:ee(),open:d,onOpenToggle:l.useCallback(()=>p(f=>!f),[p]),children:e.jsx(_.div,{"data-state":K(d),"data-disabled":n?"":void 0,...i,ref:r})})});te.displayName=B;var ne="CollapsibleTrigger",se=l.forwardRef((o,r)=>{const{__scopeCollapsible:t,...a}=o,s=U(ne,t);return e.jsx(_.button,{type:"button","aria-controls":s.contentId,"aria-expanded":s.open||!1,"data-state":K(s.open),"data-disabled":s.disabled?"":void 0,disabled:s.disabled,...a,ref:r,onClick:Z(o.onClick,s.onOpenToggle)})});se.displayName=ne;var z="CollapsibleContent",re=l.forwardRef((o,r)=>{const{forceMount:t,...a}=o,s=U(z,o.__scopeCollapsible);return e.jsx(no,{present:t||s.open,children:({present:n})=>e.jsx(ho,{...a,ref:r,present:n})})});re.displayName=z;var ho=l.forwardRef((o,r)=>{const{__scopeCollapsible:t,present:a,children:s,...n}=o,c=U(z,t),[i,d]=l.useState(a),p=l.useRef(null),f=W(r,p),u=l.useRef(0),v=u.current,g=l.useRef(0),h=g.current,C=c.open||i,j=l.useRef(C),A=l.useRef();return l.useEffect(()=>{const m=requestAnimationFrame(()=>j.current=!1);return()=>cancelAnimationFrame(m)},[]),so(()=>{const m=p.current;if(m){A.current=A.current||{transitionDuration:m.style.transitionDuration,animationName:m.style.animationName},m.style.transitionDuration="0s",m.style.animationName="none";const N=m.getBoundingClientRect();u.current=N.height,g.current=N.width,j.current||(m.style.transitionDuration=A.current.transitionDuration,m.style.animationName=A.current.animationName),d(a)}},[c.open,a]),e.jsx(_.div,{"data-state":K(c.open),"data-disabled":c.disabled?"":void 0,id:c.contentId,hidden:!C,...n,ref:f,style:{"--radix-collapsible-content-height":v?`${v}px`:void 0,"--radix-collapsible-content-width":h?`${h}px`:void 0,...o.style},children:C&&s})});function K(o){return o?"open":"closed"}var go=te,vo=se,Co=re,w="Accordion",jo=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[q,bo,No]=to(w),[L,nt]=lo(w,[No,oe]),J=oe(),ae=b.forwardRef((o,r)=>{const{type:t,...a}=o,s=a,n=a;return e.jsx(q.Provider,{scope:o.__scopeAccordion,children:t==="multiple"?e.jsx(So,{...n,ref:r}):e.jsx(yo,{...s,ref:r})})});ae.displayName=w;var[ce,Ao]=L(w),[ie,wo]=L(w,{collapsible:!1}),yo=b.forwardRef((o,r)=>{const{value:t,defaultValue:a,onValueChange:s=()=>{},collapsible:n=!1,...c}=o,[i,d]=G({prop:t,defaultProp:a,onChange:s});return e.jsx(ce,{scope:o.__scopeAccordion,value:i?[i]:[],onItemOpen:d,onItemClose:b.useCallback(()=>n&&d(""),[n,d]),children:e.jsx(ie,{scope:o.__scopeAccordion,collapsible:n,children:e.jsx(le,{...c,ref:r})})})}),So=b.forwardRef((o,r)=>{const{value:t,defaultValue:a,onValueChange:s=()=>{},...n}=o,[c=[],i]=G({prop:t,defaultProp:a,onChange:s}),d=b.useCallback(f=>i((u=[])=>[...u,f]),[i]),p=b.useCallback(f=>i((u=[])=>u.filter(v=>v!==f)),[i]);return e.jsx(ce,{scope:o.__scopeAccordion,value:c,onItemOpen:d,onItemClose:p,children:e.jsx(ie,{scope:o.__scopeAccordion,collapsible:!0,children:e.jsx(le,{...n,ref:r})})})}),[Do,R]=L(w),le=b.forwardRef((o,r)=>{const{__scopeAccordion:t,disabled:a,dir:s,orientation:n="vertical",...c}=o,i=b.useRef(null),d=W(i,r),p=bo(t),u=Ze(s)==="ltr",v=Z(o.onKeyDown,g=>{if(!jo.includes(g.key))return;const h=g.target,C=p().filter(T=>!T.ref.current?.disabled),j=C.findIndex(T=>T.ref.current===h),A=C.length;if(j===-1)return;g.preventDefault();let m=j;const N=0,y=A-1,x=()=>{m=j+1,m>y&&(m=N)},S=()=>{m=j-1,m<N&&(m=y)};switch(g.key){case"Home":m=N;break;case"End":m=y;break;case"ArrowRight":n==="horizontal"&&(u?x():S());break;case"ArrowDown":n==="vertical"&&x();break;case"ArrowLeft":n==="horizontal"&&(u?S():x());break;case"ArrowUp":n==="vertical"&&S();break}const Ne=m%A;C[Ne].ref.current?.focus()});return e.jsx(Do,{scope:t,disabled:a,direction:s,orientation:n,children:e.jsx(q.Slot,{scope:t,children:e.jsx(_.div,{...c,"data-orientation":n,ref:d,onKeyDown:a?void 0:v})})})}),I="AccordionItem",[_o,Y]=L(I),de=b.forwardRef((o,r)=>{const{__scopeAccordion:t,value:a,...s}=o,n=R(I,t),c=Ao(I,t),i=J(t),d=ee(),p=a&&c.value.includes(a)||!1,f=n.disabled||o.disabled;return e.jsx(_o,{scope:t,open:p,disabled:f,triggerId:d,children:e.jsx(go,{"data-orientation":n.orientation,"data-state":he(p),...i,...s,ref:r,disabled:f,open:p,onOpenChange:u=>{u?c.onItemOpen(a):c.onItemClose(a)}})})});de.displayName=I;var pe="AccordionHeader",ue=b.forwardRef((o,r)=>{const{__scopeAccordion:t,...a}=o,s=R(w,t),n=Y(pe,t);return e.jsx(_.h3,{"data-orientation":s.orientation,"data-state":he(n.open),"data-disabled":n.disabled?"":void 0,...a,ref:r})});ue.displayName=pe;var H="AccordionTrigger",me=b.forwardRef((o,r)=>{const{__scopeAccordion:t,...a}=o,s=R(w,t),n=Y(H,t),c=wo(H,t),i=J(t);return e.jsx(q.ItemSlot,{scope:t,children:e.jsx(vo,{"aria-disabled":n.open&&!c.collapsible||void 0,"data-orientation":s.orientation,id:n.triggerId,...i,...a,ref:r})})});me.displayName=H;var xe="AccordionContent",fe=b.forwardRef((o,r)=>{const{__scopeAccordion:t,...a}=o,s=R(w,t),n=Y(xe,t),c=J(t);return e.jsx(Co,{role:"region","aria-labelledby":n.triggerId,"data-orientation":s.orientation,...c,...a,ref:r,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...o.style}})});fe.displayName=xe;function he(o){return o?"open":"closed"}var Po=ae,Eo=de,Io=ue,ge=me,ve=fe;const Lo=Po,Ce=l.forwardRef(({className:o,...r},t)=>e.jsx(Eo,{ref:t,className:V("border-b",o),...r}));Ce.displayName="AccordionItem";const je=l.forwardRef(({className:o,children:r,...t},a)=>e.jsx(Io,{className:"flex",children:e.jsxs(ge,{ref:a,className:V("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",o),...t,children:[r,e.jsx(ao,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));je.displayName=ge.displayName;const be=l.forwardRef(({className:o,children:r,...t},a)=>e.jsx(ve,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...t,children:e.jsx("div",{className:V("pb-4 pt-0",o),children:r})}));be.displayName=ve.displayName;const Ro=({course:o,user:r,enableAI:t=!1})=>{const{toast:a}=F(),[s,n]=l.useState(!1),c=async()=>{n(!0);const d=await(await fetch("/api/lessons/generate/array",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({course:o,user:r})})).json();d.message==="success"?window.location.reload():a({title:"Error",description:d.message,variant:"destructive"}),n(!1)};return e.jsxs("div",{className:"grid place-content-center gap-4 py-10",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Lecciones no encontradas"}),t&&(s?e.jsxs(E,{disabled:!0,children:[e.jsx(Qe,{className:"h-4 w-4 mr-2 animate-spin"}),"Generando lecciones automáticamente"]}):e.jsxs(E,{onClick:c,children:[e.jsx(We,{className:"h-4 w-4 mr-2"}),"Generar lecciones automáticamente"]}))]})},To=()=>e.jsxs("div",{className:"grid grid-flow-row auto-rows-min gap-4 border border-gray-100 p-4 rounded-md",children:[e.jsx(k,{className:"h-12 w-11/12"}),e.jsx(k,{className:"h-4 w-8/12"}),e.jsx(k,{className:"h-3 w-8/12"})]}),Oo=({course:o})=>e.jsxs(E,{variant:"default",className:"fixed bottom-4 right-4",onClick:()=>P(`/lessons/${o.id}/editor`),children:[e.jsx(Je,{className:"w-4 h-4"}),"Nueva lección"]}),st=({course:o,user:r})=>{const[t,a]=l.useState(!0),[s,n]=l.useState(0),[c,i]=l.useState(0),[d,p]=l.useState(0),[f,u]=l.useState([]),[v,g]=l.useState([]),[h,C]=l.useState([]),{toast:j}=F(),A=async N=>{a(!0);const x=await(await fetch(`/api/lessons?courseId=${N}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}})).json();x.message==="success"?(n(x.count.all),i(x.count.done),p(x.count.undone),u(x.lessons.all),g(x.lessons.undone),C(x.lessons.done)):j({title:"Error",description:"No se pudieron cargar las lecciones.",variant:"destructive"}),a(!1)};l.useEffect(()=>{o.id&&A(o.id)},[o.id]);const m=N=>{const y={ALL:f,DONE:h,UNDONE:v}[N];return e.jsx(e.Fragment,{children:t?[1,2,3].map(x=>e.jsx(To,{},x)):y.length>0?e.jsx(Lo,{type:"multiple",className:"w-full",defaultValue:y.map(x=>x.key),children:y.map(x=>e.jsxs(Ce,{value:x.key,children:[e.jsx(je,{children:e.jsxs("div",{className:"grid grid-flow-col gap-2 items-center",children:[e.jsx(ro,{className:"h-4 w-4"}),"Semana ",x.week,", ",x.year]})}),e.jsx(be,{children:e.jsx("div",{className:"grid grid-flow-row auto-rows-min gap-2",children:x.lessons.map(S=>e.jsx(io,{lesson:S},S.id))})})]},x.key))}):e.jsx(Ro,{course:o,user:r,enableAI:N==="ALL"})})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 mt-4 pb-20",children:[e.jsxs(Ae,{className:"bg-blue-50 border-blue-600",children:[e.jsx(we,{className:"h-4 w-4",color:"rgb(37 99 235)"}),e.jsx(ye,{className:"text-blue-600",children:e.jsx("strong",{children:"Contenido del curso"})}),e.jsx(Se,{className:"text-blue-600",children:"A continuación se muestran las lecciones que componen el contenido de tu curso agrupado por semanas."})]}),e.jsxs(eo,{defaultValue:"ALL",children:[e.jsxs(oo,{children:[e.jsxs(M,{value:"ALL",children:["Todos",e.jsx(D,{variant:"outline",className:"ml-1",children:s})]}),e.jsxs(M,{value:"UNDONE",children:["Pendientes",e.jsx(D,{variant:"outline",className:"ml-1",children:d})]}),e.jsxs(M,{value:"DONE",children:["Finalizados",e.jsx(D,{variant:"outline",className:"ml-1",children:c})]})]}),e.jsx($,{value:"ALL",children:m("ALL")}),e.jsx($,{value:"UNDONE",children:m("UNDONE")}),e.jsx($,{value:"DONE",children:m("DONE")})]})]}),e.jsx(Oo,{course:o})]})};export{st as LessonList};
