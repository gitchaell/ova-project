import{j as e,P as L,u as W,c as F}from"./index.DBbjwa8k.js";import{r as l,R as h}from"./index.lFdC2nkX.js";import{u as G}from"./use-toast.Bu7IqXVg.js";import{A as we,I as ye,a as De,b as Ie}from"./alert.DYqv2Hsw.js";import{n as E}from"./router.B-sij-_X.js";import{C as Le,a as Ee,b as Re,c as Pe}from"./card.B6GGl3D2.js";import{A as Se,a as _e,b as Te,c as Oe,d as ke,e as Me,f as $e,g as Ve,h as Fe}from"./alert-dialog.BGgg8BIq.js";import{D as Ge,a as He,E as Ue,C as ze,B as I,b as Be,c as Ke,d as Q,e as qe,f as O,T as Je,S as k,P as Ye}from"./skeleton.o5leZJyV.js";import{l as Qe,L as We,S as Xe}from"./LessonDate.oIHL9kaZ.js";import{B as R}from"./button.AZqx0Umo.js";import{S as Ze}from"./settings.BD3JD6WR.js";import{c as X}from"./createLucideIcon.BAPAnDpJ.js";import{u as es,T as ss,a as ns,b as M,c as $}from"./tabs.CrGyxHtg.js";import{c as Z,u as os}from"./index.BLNbD4pj.js";import{c as ts}from"./index.DbJ_ZDUh.js";import{u as H,c as ee,P as as}from"./index.BatipnVx.js";import{u as se}from"./index.CTnt_JEC.js";import{C as rs}from"./calendar.C642oMSj.js";import"./index.CxOCE76-.js";import"./index.C3TQdI97.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=X("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=X("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ls=({lesson:s})=>{const{toast:t}=G(),n=async()=>{const r=await(await fetch("/api/lessons",{method:"DELETE",headers:{Accept:"application.json","Content-Type":"application/json"},body:JSON.stringify({lessonId:s.id})})).json();r.message==="success"?t({title:"Lección eliminada",description:`La lección "${s.title}" ha sido eliminada`}):t({title:"Algo salió mal!",description:r.message,variant:"destructive"})};return e.jsxs(Se,{children:[e.jsxs(Ge,{children:[e.jsx(Le,{className:"cursor-pointer hover:bg-slate-50",onClick:()=>E("/lessons/editor/"+s.id),children:e.jsxs(Ee,{children:[e.jsxs("div",{className:"grid grid-cols-[1fr_min-content] gap-2",children:[e.jsx(Re,{children:s.title}),e.jsx(He,{asChild:!0,children:e.jsx(R,{type:"button",size:"icon",variant:"outline",children:e.jsx(Ue,{})})})]}),e.jsx(Pe,{className:"text-slate-700 line-clamp-2",children:s.caption}),e.jsxs("div",{className:"grid grid-cols-[1fr_min-content] items-center gap-2 ",children:[e.jsxs("div",{className:"grid grid-cols-[min-content_1fr_min-content] items-center gap-2 text-sm text-gray-500",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{children:Qe.formatRange(new Date(s.start),new Date(s.end))})]}),s.done?e.jsx(I,{className:"bg-green-100 border-green-500 text-green-600 hover:bg-green-200 w-fit",children:"Finalizado"}):e.jsx(I,{variant:"outline",className:"w-fit",children:"Pendiente"})]})]})}),e.jsxs(Be,{className:"w-56",children:[e.jsx(Ke,{children:"Opciones"}),e.jsx(Q,{}),e.jsxs(qe,{children:[e.jsxs(O,{onSelect:()=>E("/lessons/editor/"+s.id),children:[e.jsx(Ze,{}),e.jsx("span",{children:"Editar"})]}),e.jsxs(O,{onSelect:()=>E("/lessons/preview/"+s.id),children:[e.jsx(cs,{}),e.jsx("span",{children:"Previsualizar"})]})]}),e.jsx(Q,{}),e.jsx(_e,{asChild:!0,children:e.jsxs(O,{className:"text-red-500",children:[e.jsx(Je,{}),e.jsx("span",{children:"Eliminar"})]})})]})]}),e.jsxs(Te,{children:[e.jsxs(Oe,{children:[e.jsxs(ke,{children:['¿Está seguro de eliminar la lección "',s.title,'"?']}),e.jsx(Me,{children:"Esta acción no se podrá deshacer. Todos los datos de esta lección serán eliminados permanentemente de la de base de datos."})]}),e.jsxs($e,{children:[e.jsx(Ve,{children:"Cancelar"}),e.jsx(Fe,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:n,children:"Eliminar lección"})]})]})]})};var U="Collapsible",[ds,ne]=Z(U),[ps,z]=ds(U),oe=l.forwardRef((s,t)=>{const{__scopeCollapsible:n,open:o,defaultOpen:r,disabled:a,onOpenChange:i,...p}=s,[u=!1,m]=H({prop:o,defaultProp:r,onChange:i});return e.jsx(ps,{scope:n,disabled:a,contentId:se(),open:u,onOpenToggle:l.useCallback(()=>m(x=>!x),[m]),children:e.jsx(L.div,{"data-state":K(u),"data-disabled":a?"":void 0,...p,ref:t})})});oe.displayName=U;var te="CollapsibleTrigger",ae=l.forwardRef((s,t)=>{const{__scopeCollapsible:n,...o}=s,r=z(te,n);return e.jsx(L.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":K(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...o,ref:t,onClick:ee(s.onClick,r.onOpenToggle)})});ae.displayName=te;var B="CollapsibleContent",re=l.forwardRef((s,t)=>{const{forceMount:n,...o}=s,r=z(B,s.__scopeCollapsible);return e.jsx(as,{present:n||r.open,children:({present:a})=>e.jsx(us,{...o,ref:t,present:a})})});re.displayName=B;var us=l.forwardRef((s,t)=>{const{__scopeCollapsible:n,present:o,children:r,...a}=s,i=z(B,n),[p,u]=l.useState(o),m=l.useRef(null),x=W(t,m),f=l.useRef(0),N=f.current,j=l.useRef(0),y=j.current,v=i.open||p,C=l.useRef(v),b=l.useRef();return l.useEffect(()=>{const c=requestAnimationFrame(()=>C.current=!1);return()=>cancelAnimationFrame(c)},[]),os(()=>{const c=m.current;if(c){b.current=b.current||{transitionDuration:c.style.transitionDuration,animationName:c.style.animationName},c.style.transitionDuration="0s",c.style.animationName="none";const g=c.getBoundingClientRect();f.current=g.height,j.current=g.width,C.current||(c.style.transitionDuration=b.current.transitionDuration,c.style.animationName=b.current.animationName),u(o)}},[i.open,o]),e.jsx(L.div,{"data-state":K(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!v,...a,ref:x,style:{"--radix-collapsible-content-height":N?`${N}px`:void 0,"--radix-collapsible-content-width":y?`${y}px`:void 0,...s.style},children:v&&r})});function K(s){return s?"open":"closed"}var ms=oe,xs=ae,fs=re,A="Accordion",hs=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[q,gs,js]=ts(A),[S,Xs]=Z(A,[js,ne]),J=ne(),ie=h.forwardRef((s,t)=>{const{type:n,...o}=s,r=o,a=o;return e.jsx(q.Provider,{scope:s.__scopeAccordion,children:n==="multiple"?e.jsx(As,{...a,ref:t}):e.jsx(bs,{...r,ref:t})})});ie.displayName=A;var[ce,vs]=S(A),[le,Cs]=S(A,{collapsible:!1}),bs=h.forwardRef((s,t)=>{const{value:n,defaultValue:o,onValueChange:r=()=>{},collapsible:a=!1,...i}=s,[p,u]=H({prop:n,defaultProp:o,onChange:r});return e.jsx(ce,{scope:s.__scopeAccordion,value:p?[p]:[],onItemOpen:u,onItemClose:h.useCallback(()=>a&&u(""),[a,u]),children:e.jsx(le,{scope:s.__scopeAccordion,collapsible:a,children:e.jsx(de,{...i,ref:t})})})}),As=h.forwardRef((s,t)=>{const{value:n,defaultValue:o,onValueChange:r=()=>{},...a}=s,[i=[],p]=H({prop:n,defaultProp:o,onChange:r}),u=h.useCallback(x=>p((f=[])=>[...f,x]),[p]),m=h.useCallback(x=>p((f=[])=>f.filter(N=>N!==x)),[p]);return e.jsx(ce,{scope:s.__scopeAccordion,value:i,onItemOpen:u,onItemClose:m,children:e.jsx(le,{scope:s.__scopeAccordion,collapsible:!0,children:e.jsx(de,{...a,ref:t})})})}),[Ns,_]=S(A),de=h.forwardRef((s,t)=>{const{__scopeAccordion:n,disabled:o,dir:r,orientation:a="vertical",...i}=s,p=h.useRef(null),u=W(p,t),m=gs(n),f=es(r)==="ltr",N=ee(s.onKeyDown,j=>{if(!hs.includes(j.key))return;const y=j.target,v=m().filter(T=>!T.ref.current?.disabled),C=v.findIndex(T=>T.ref.current===y),b=v.length;if(C===-1)return;j.preventDefault();let c=C;const g=0,w=b-1,d=()=>{c=C+1,c>w&&(c=g)},D=()=>{c=C-1,c<g&&(c=w)};switch(j.key){case"Home":c=g;break;case"End":c=w;break;case"ArrowRight":a==="horizontal"&&(f?d():D());break;case"ArrowDown":a==="vertical"&&d();break;case"ArrowLeft":a==="horizontal"&&(f?D():d());break;case"ArrowUp":a==="vertical"&&D();break}const Ne=c%b;v[Ne].ref.current?.focus()});return e.jsx(Ns,{scope:n,disabled:o,direction:r,orientation:a,children:e.jsx(q.Slot,{scope:n,children:e.jsx(L.div,{...i,"data-orientation":a,ref:u,onKeyDown:o?void 0:N})})})}),P="AccordionItem",[ws,Y]=S(P),pe=h.forwardRef((s,t)=>{const{__scopeAccordion:n,value:o,...r}=s,a=_(P,n),i=vs(P,n),p=J(n),u=se(),m=o&&i.value.includes(o)||!1,x=a.disabled||s.disabled;return e.jsx(ws,{scope:n,open:m,disabled:x,triggerId:u,children:e.jsx(ms,{"data-orientation":a.orientation,"data-state":ge(m),...p,...r,ref:t,disabled:x,open:m,onOpenChange:f=>{f?i.onItemOpen(o):i.onItemClose(o)}})})});pe.displayName=P;var ue="AccordionHeader",me=h.forwardRef((s,t)=>{const{__scopeAccordion:n,...o}=s,r=_(A,n),a=Y(ue,n);return e.jsx(L.h3,{"data-orientation":r.orientation,"data-state":ge(a.open),"data-disabled":a.disabled?"":void 0,...o,ref:t})});me.displayName=ue;var V="AccordionTrigger",xe=h.forwardRef((s,t)=>{const{__scopeAccordion:n,...o}=s,r=_(A,n),a=Y(V,n),i=Cs(V,n),p=J(n);return e.jsx(q.ItemSlot,{scope:n,children:e.jsx(xs,{"aria-disabled":a.open&&!i.collapsible||void 0,"data-orientation":r.orientation,id:a.triggerId,...p,...o,ref:t})})});xe.displayName=V;var fe="AccordionContent",he=h.forwardRef((s,t)=>{const{__scopeAccordion:n,...o}=s,r=_(A,n),a=Y(fe,n),i=J(n);return e.jsx(fs,{role:"region","aria-labelledby":a.triggerId,"data-orientation":r.orientation,...i,...o,ref:t,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...s.style}})});he.displayName=fe;function ge(s){return s?"open":"closed"}var ys=ie,Ds=pe,Is=me,je=xe,ve=he;const Ls=ys,Ce=l.forwardRef(({className:s,...t},n)=>e.jsx(Ds,{ref:n,className:F("border-b",s),...t}));Ce.displayName="AccordionItem";const be=l.forwardRef(({className:s,children:t,...n},o)=>e.jsx(Is,{className:"flex",children:e.jsxs(je,{ref:o,className:F("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...n,children:[t,e.jsx(is,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));be.displayName=je.displayName;const Ae=l.forwardRef(({className:s,children:t,...n},o)=>e.jsx(ve,{ref:o,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:e.jsx("div",{className:F("pb-4 pt-0",s),children:t})}));Ae.displayName=ve.displayName;const Es=({course:s,user:t,enableAI:n=!1})=>{const{toast:o}=G(),[r,a]=l.useState(!1),i=async()=>{a(!0);const u=await(await fetch("/api/lessons/generate/array",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({course:s,user:t})})).json();u.message==="success"?window.location.reload():o({title:"Error",description:u.message,variant:"destructive"}),a(!1)};return e.jsxs("div",{className:"grid place-content-center gap-4 py-10",children:[e.jsx("p",{className:"text-gray-600 text-center",children:"Lecciones no encontradas"}),n&&(r?e.jsxs(R,{disabled:!0,children:[e.jsx(We,{className:"h-4 w-4 mr-2 animate-spin"}),"Generando lecciones automáticamente"]}):e.jsxs(R,{onClick:i,children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Generar lecciones automáticamente"]}))]})},Rs=()=>e.jsxs("div",{className:"grid grid-flow-row auto-rows-min gap-4 border border-gray-100 p-4 rounded-md",children:[e.jsx(k,{className:"h-12 w-11/12"}),e.jsx(k,{className:"h-4 w-8/12"}),e.jsx(k,{className:"h-3 w-8/12"})]}),Ps=({course:s})=>e.jsxs(R,{variant:"default",className:"fixed bottom-4 right-4",onClick:()=>E(`/lessons/${s.id}/editor`),children:[e.jsx(Ye,{className:"w-4 h-4"}),"Nueva lección"]}),Zs=({course:s,user:t})=>{const[n,o]=l.useState(!0),[r,a]=l.useState(0),[i,p]=l.useState(0),[u,m]=l.useState(0),[x,f]=l.useState([]),[N,j]=l.useState([]),[y,v]=l.useState([]),{toast:C}=G(),b=async g=>{o(!0);const d=await(await fetch(`/api/lessons?courseId=${g}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}})).json();d.message==="success"?(a(d.count.all),p(d.count.done),m(d.count.undone),f(d.lessons.all),j(d.lessons.undone),v(d.lessons.done)):C({title:"Error",description:"No se pudieron cargar las lecciones.",variant:"destructive"}),o(!1)};l.useEffect(()=>{s.id&&b(s.id)},[s.id]);const c=g=>{const w={ALL:x,DONE:y,UNDONE:N}[g];return e.jsx(e.Fragment,{children:n?[1,2,3].map(d=>e.jsx(Rs,{},d)):w.length>0?e.jsx(Ls,{type:"multiple",className:"w-full",defaultValue:w.map(d=>d.key),children:w.map(d=>e.jsxs(Ce,{value:d.key,children:[e.jsx(be,{children:e.jsxs("div",{className:"grid grid-flow-col gap-2 items-center",children:[e.jsx(rs,{className:"h-4 w-4"}),"Semana ",d.week,", ",d.year]})}),e.jsx(Ae,{children:e.jsx("div",{className:"grid grid-flow-row auto-rows-min gap-2",children:d.lessons.map(D=>e.jsx(ls,{lesson:D},D.id))})})]},d.key))}):e.jsx(Es,{course:s,user:t,enableAI:g==="ALL"})})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid gap-4 mt-4 pb-20",children:[e.jsxs(we,{className:"bg-blue-50 border-blue-600",children:[e.jsx(ye,{className:"h-4 w-4",color:"rgb(37 99 235)"}),e.jsx(De,{className:"text-blue-600",children:e.jsx("strong",{children:"Contenido del curso"})}),e.jsx(Ie,{className:"text-blue-600",children:"A continuación se muestran las lecciones que componen el contenido de tu curso agrupado por semanas."})]}),e.jsxs(ss,{defaultValue:"ALL",children:[e.jsxs(ns,{children:[e.jsxs(M,{value:"ALL",children:["Todos",e.jsx(I,{variant:"outline",className:"ml-1",children:r})]}),e.jsxs(M,{value:"UNDONE",children:["Pendientes",e.jsx(I,{variant:"outline",className:"ml-1",children:u})]}),e.jsxs(M,{value:"DONE",children:["Finalizados",e.jsx(I,{variant:"outline",className:"ml-1",children:i})]})]}),e.jsx($,{value:"ALL",children:c("ALL")}),e.jsx($,{value:"UNDONE",children:c("UNDONE")}),e.jsx($,{value:"DONE",children:c("DONE")})]})]}),e.jsx(Ps,{course:s})]})};export{Zs as LessonList};
